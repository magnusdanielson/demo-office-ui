<template>
  <require from="./pickers.css"></require>
  <div
    class="content"
    style="bottom: unset; top: 0px; background-color: rgb(3, 131, 135);">
    <h1 class="pageTitle">People Pickers</h1>
    <div
      role="presentation"
      class="ms-FocusZone"
      
    ></div>
  </div>
  <div class="PageSection">
      <examplecard title="Controlled Processed List People Picker">
          <div slot="code">
            <hljs language="html" linenumbers="true">
  &lt;du-list-people-picker
  on-change.bind=&quot;onChangeList&quot;
  items.bind=&quot;selectedItemsList&quot;
  on-item-selected.bind=&quot;onItemSelected&quot;
  on-resolve-suggestions.bind=&quot;_onFilterChanged&quot;
  get-text-from-item.bind=&quot;_getTextFromItem&quot;
  input-props.bind=&quot;inputProps&quot; 
  on-empty-input-focus.bind=&quot;_returnMostRecentlyUsed&quot;
  class-name=&quot;ms-PeoplePicker&quot;
  picker-suggestions-props.bind=&quot;suggestionProps&quot;
  key=&quot;list&quot;
  on-remove-suggestion.bind=&quot;_onRemoveSuggestion&quot;
  on-validate-input.bind=&quot;_validateInput&quot;
  resolve-delay.one-time=&quot;300&quot;   
  &gt;&lt;/du-list-people-picker&gt;
  &lt;du-label&gt;Below list is bound to aurelia property on view model&lt;/du-label&gt;
  &lt;ul&gt;
    &lt;li style=&quot;list-style-type: none;&quot; repeat.for=&quot;item of selectedItemsList&quot;&gt;${item.text}&lt;/li&gt;
  &lt;/ul&gt;
            </hljs>
            <hljs language="javascript" linenumbers="true">
  state:any;

  public selectedItemsNormal: any[] = [];
  public onChangeNormal(this:IDuReactWrapper, args:any[])
  {
      this.parent.selectedItemsNormal = args[0];
  }

  public selectedItemsCompact: any[] = [];
  public onChangeCompact(this:IDuReactWrapper,args:any[])
  {
      this.parent.selectedItemsCompact = args[0];
  }

  public selectedItemsList: any[] = [];
  public onChangeList(this:IDuReactWrapper,args:any[])
  {
      this.parent.selectedItemsList = args[0];
  }

  public selectedItemsLimited: any[] = [];
  public onChangeLimited(this:IDuReactWrapper, args:any[])
  {
      this.parent.selectedItemsLimited = args[0];
  }
  // OK
  private onItemSelected(args:any[]): IPersonaProps | null
  {
      let item: IPersonaProps = args[0];

      // Put your logic here to return null or modify object

      return item;
  }

  // OK
  suggestionProps: IBasePickerSuggestionsProps = 
  {
      suggestionsHeaderText: &#39;Suggested People&#39;,
      mostRecentlyUsedHeaderText: &#39;Suggested Contacts&#39;,
      noResultsFoundText: &#39;No results found&#39;,
      loadingText: &#39;Loading&#39;,
      showRemoveButtons: true,
      suggestionsAvailableAlertText: &#39;People Picker Suggestions available&#39;,
      suggestionsContainerAriaLabel: &#39;Suggested contacts&#39;
  };

  limitedSearchSuggestionProps: IBasePickerSuggestionsProps = 
  assign({
      searchForMoreText: &#39;Load all Results&#39;,
      resultsMaximumNumber: 10,
      searchingText: &#39;Searching...&#39;
    }, this.suggestionProps);
  

  // OK
  inputProps:any = {
      onBlur: (ev: any) =&gt; console.log(&#39;onBlur called&#39;),
      onFocus: (ev: any) =&gt; console.log(&#39;onFocus called&#39;),
      &#39;aria-label&#39;: &#39;People Picker&#39;
  };

  constructor() 
  {    
      this.state = {
          delayResults: false,
          peopleList: people,
          mostRecentlyUsed: mru
      };
      this.selectedItemsCompact = people.splice(0, 3)
  }

  // OK
  private _returnMostRecentlyUsed(this:IDuReactWrapper,args:any[]): IPersonaProps[] | Promise&lt;IPersonaProps[]&gt;
  {
      let currentPersonas: IPersonaProps[] = args[0];
      let { mostRecentlyUsed } = this.parent.state;
      mostRecentlyUsed = this.parent._removeDuplicates(mostRecentlyUsed, currentPersonas);
      return this.parent._filterPromise(mostRecentlyUsed);
  }

  private _returnMostRecentlyUsedWithLimit(this:IDuReactWrapper, args:any[]): IPersonaProps[] | Promise&lt;IPersonaProps[]&gt;
  {
      let currentPersonas: IPersonaProps[] = args[0];
      console.log(&quot;_returnMostRecentlyUsedWithLimit&quot;)
      let { mostRecentlyUsed } = this.parent.state;
      mostRecentlyUsed = this.parent._removeDuplicates(mostRecentlyUsed, currentPersonas);
      mostRecentlyUsed = mostRecentlyUsed.splice(0, 3);
      return this.parent._filterPromise(mostRecentlyUsed);
    };

    // OK
    private _removeDuplicates(personas: IPersonaProps[], possibleDupes: IPersonaProps[]) 
    {
      return personas.filter(persona =&gt; !this._listContainsPersona(persona, possibleDupes));
    }

    // OK
    private _filterPromise(personasToReturn: IPersonaProps[]): IPersonaProps[] | Promise&lt;IPersonaProps[]&gt; 
    {
      if (this.state.delayResults) {
        return this._convertResultsToPromise(personasToReturn);
      } else {
        return personasToReturn;
      }
    }

    // OK
    private _listContainsPersona(persona: IPersonaProps, personas: IPersonaProps[]) 
    {
      if (!personas || !personas.length || personas.length === 0) {
        return false;
      }
      return personas.filter(item =&gt; item.text === persona.text).length &gt; 0;
    }

    // OK
    private _convertResultsToPromise(results: IPersonaProps[]): Promise&lt;IPersonaProps[]&gt; {
      return new Promise&lt;IPersonaProps[]&gt;((resolve, reject) =&gt; setTimeout(() =&gt; resolve(results), 2000));
    }

    // Never called?
    private _onRemoveSuggestion(item: IPersonaProps): void
    {
      console.log(&quot;_onRemoveSuggestion&quot;);
      console.log(this);

      const { peopleList, mostRecentlyUsed: mruState } = this.state;
      const indexPeopleList: number = peopleList.indexOf(item);
      const indexMostRecentlyUsed: number = mruState.indexOf(item);
  
      if (indexPeopleList &gt;= 0) {
        const newPeople: IPersonaProps[] = peopleList.slice(0, indexPeopleList).concat(peopleList.slice(indexPeopleList + 1));
        this.state.peopleList = newPeople;
      }
  
      if (indexMostRecentlyUsed &gt;= 0) {
        const newSuggestedPeople: IPersonaProps[] = mruState
          .slice(0, indexMostRecentlyUsed)
          .concat(mruState.slice(indexMostRecentlyUsed + 1));
        this.state.mostRecentlyUsed = newSuggestedPeople;
      }
    };

    // Never called?
    private _validateInput(input: string): ValidationState
    {
        console.log(&quot;_validateInput&quot;);
      if (input.indexOf(&#39;@&#39;) !== -1) {
        return ValidationState.valid;
      } else if (input.length &gt; 1) {
        return ValidationState.warning;
      } else {
        return ValidationState.invalid;
      }
    };

    private _onFilterChangedWithLimit(this:IDuReactWrapper, args:any[]) : IPersonaProps[] | Promise&lt;IPersonaProps[]&gt;
    {
      let filterText: string = args[0];
      let currentPersonas: IPersonaProps[] = args[1];
      let limitResults = 3
        
      if (filterText) 
      {
        let filteredPersonas: IPersonaProps[] = this.parent._filterPersonasByText(filterText);
  
        filteredPersonas = this.parent._removeDuplicates(filteredPersonas, currentPersonas);
        filteredPersonas = filteredPersonas.splice(0, limitResults);

        return this.parent._filterPromise(filteredPersonas);
      } 
      else 
      {
        return [];
      }
    };

    // OK
    private _onFilterChanged(this:IDuReactWrapper, args:any[]): IPersonaProps[] | Promise&lt;IPersonaProps[]&gt; 
    {
      let filterText: string = args[0];
      let currentPersonas: IPersonaProps[] = args[1];
      let limitResults: undefined | number;
      if(args.length == 3)
      {
          limitResults = args[2];
      }
        
      if (filterText) 
      {
        let filteredPersonas: IPersonaProps[] = this.parent._filterPersonasByText(filterText);
  
        filteredPersonas = this.parent._removeDuplicates(filteredPersonas, currentPersonas);
        filteredPersonas = limitResults ? filteredPersonas.splice(0, limitResults) : filteredPersonas;
        return this.parent._filterPromise(filteredPersonas);
      } 
      else 
      {
        return [];
      }
    };

    // OK
    private _filterPersonasByText(filterText: string): IPersonaProps[] 
    {
      return this.state.peopleList.filter(item =&gt; this._doesTextStartWith(item.text as string, filterText));
    }

    // OK
    private _doesTextStartWith(text: string, filterText: string): boolean {
      return text.toLowerCase().indexOf(filterText.toLowerCase()) === 0;
    }
  
    // OK
    private _getTextFromItem(persona: IPersonaProps): string {
      return persona.text as string;
    }
            </hljs>
          </div>
          <div slot="example">
            <du-list-people-picker
            on-change.bind="onChangeList"
            items.bind="selectedItemsList"
            on-item-selected.bind="onItemSelected"
            on-resolve-suggestions.bind="_onFilterChanged"
            get-text-from-item.bind="_getTextFromItem"
            input-props.bind="inputProps" 
            on-empty-input-focus.bind="_returnMostRecentlyUsed"
            class-name="ms-PeoplePicker"
            picker-suggestions-props.bind="suggestionProps"
            key="list"
            on-remove-suggestion.bind="_onRemoveSuggestion"
            on-validate-input.bind="_validateInput"
            resolve-delay.one-time="300"   
            ></du-list-people-picker>
            <du-label>Below list is bound to aurelia property on view model</du-label>
            <ul>
              <li style="list-style-type: none;" repeat.for="item of selectedItemsList">${item.text}</li>
            </ul>
          </div>  
    </examplecard>


    <examplecard title="Controlled Processed Compact People Picker, with preselect">
      <div slot="code">
        <hljs language="html" linenumbers="true">
  &lt;du-compact-people-picker
  on-change.bind=&quot;onChangeCompact&quot;
  items.bind=&quot;selectedItemsCompact&quot;
  default-selected-items.one-time=&quot;state.peopleList.splice(0, 3)&quot;
  on-item-selected.bind=&quot;onItemSelected&quot;
  on-resolve-suggestions.bind=&quot;_onFilterChanged&quot;
  get-text-from-item.bind=&quot;_getTextFromItem&quot;
  input-props.bind=&quot;inputProps&quot; 
  on-empty-input-focus.bind=&quot;_returnMostRecentlyUsed&quot;
  class-name=&quot;ms-PeoplePicker&quot;
  picker-suggestions-props.bind=&quot;suggestionProps&quot;
  key=&quot;compact&quot;
  on-remove-suggestion.bind=&quot;_onRemoveSuggestion&quot;
  on-validate-input.bind=&quot;_validateInput&quot;
  resolve-delay.one-time=&quot;300&quot;   
  &gt;&lt;/du-compact-people-picker&gt;
  &lt;du-label&gt;Below list is bound to aurelia property on view model&lt;/du-label&gt;
  &lt;ul&gt;
    &lt;li style=&quot;list-style-type: none;&quot; repeat.for=&quot;item of selectedItemsCompact&quot;&gt;${item.text}&lt;/li&gt;
  &lt;/ul&gt;
        </hljs>
      </div>
      <div slot="example">
        <du-compact-people-picker
        on-change.bind="onChangeCompact"
        items.bind="selectedItemsCompact"
        default-selected-items.one-time="state.peopleList.splice(0, 3)"
        on-item-selected.bind="onItemSelected"
        on-resolve-suggestions.bind="_onFilterChanged"
        get-text-from-item.bind="_getTextFromItem"
        input-props.bind="inputProps" 
        on-empty-input-focus.bind="_returnMostRecentlyUsed"
        class-name="ms-PeoplePicker"
        picker-suggestions-props.bind="suggestionProps"
        key="compact"
        on-remove-suggestion.bind="_onRemoveSuggestion"
        on-validate-input.bind="_validateInput"
        resolve-delay.one-time="300"   
        ></du-compact-people-picker>
        <du-label>Below list is bound to aurelia property on view model</du-label>
        <ul>
          <li style="list-style-type: none;" repeat.for="item of selectedItemsCompact">${item.text}</li>
        </ul>
      </div>  
</examplecard>
    


<examplecard title="Controlled Processed Normal People Picker">
  <div slot="code">
    <hljs language="html" linenumbers="true">
  &lt;du-normal-people-picker
  on-change.bind=&quot;onChangeNormal&quot;
  items.bind=&quot;selectedItemsNormal&quot;
  on-item-selected.bind=&quot;onItemSelected&quot;
  on-resolve-suggestions.bind=&quot;_onFilterChanged&quot;
  get-text-from-item.bind=&quot;_getTextFromItem&quot;
  input-props.bind=&quot;inputProps&quot; 
  on-empty-input-focus.bind=&quot;_returnMostRecentlyUsed&quot;
  class-name=&quot;ms-PeoplePicker&quot;
  picker-suggestions-props.bind=&quot;suggestionProps&quot;
  key=&quot;normal&quot;
  on-remove-suggestion.bind=&quot;_onRemoveSuggestion&quot;
  on-validate-input.bind=&quot;_validateInput&quot;
  resolve-delay.one-time=&quot;300&quot;
  &gt;&lt;/du-normal-people-picker&gt;
  &lt;du-label&gt;Below list is bound to aurelia property on view model&lt;/du-label&gt;
  &lt;ul&gt;
    &lt;li style=&quot;list-style-type: none;&quot; repeat.for=&quot;item of selectedItemsNormal&quot;&gt;${item.text}&lt;/li&gt;
  &lt;/ul&gt;
    </hljs>
  </div>
  <div slot="example">
    <du-normal-people-picker
    on-change.bind="onChangeNormal"
    items.bind="selectedItemsNormal"
    on-item-selected.bind="onItemSelected"
    on-resolve-suggestions.bind="_onFilterChanged"
    get-text-from-item.bind="_getTextFromItem"
    input-props.bind="inputProps" 
    on-empty-input-focus.bind="_returnMostRecentlyUsed"
    class-name="ms-PeoplePicker"
    picker-suggestions-props.bind="suggestionProps"
    key="normal"
    on-remove-suggestion.bind="_onRemoveSuggestion"
    on-validate-input.bind="_validateInput"
    resolve-delay.one-time="300"
    ></du-normal-people-picker>
    <du-label>Below list is bound to aurelia property on view model</du-label>
    <ul>
      <li style="list-style-type: none;" repeat.for="item of selectedItemsNormal">${item.text}</li>
    </ul>
  </div>  
</examplecard>

<examplecard title="Controlled Processed Limited to 3 Compact People Picker">
  <div slot="code">
    <hljs language="html" linenumbers="true">
  &lt;du-compact-people-picker
  on-change.bind=&quot;onChangeLimited&quot;
  items.bind=&quot;selectedItemsLimited&quot;
  on-item-selected.bind=&quot;onItemSelected&quot;
  on-resolve-suggestions.bind=&quot;_onFilterChangedWithLimit&quot;
  get-text-from-item.bind=&quot;_getTextFromItem&quot;
  input-props.bind=&quot;inputProps&quot; 
  on-empty-input-focus.bind=&quot;_returnMostRecentlyUsedWithLimit&quot;
  class-name=&quot;ms-PeoplePicker&quot;
  picker-suggestions-props.bind=&quot;limitedSearchSuggestionProps&quot;
  key=&quot;compact&quot;
  on-remove-suggestion.bind=&quot;_onRemoveSuggestion&quot;
  on-validate-input.bind=&quot;_validateInput&quot;
  resolve-delay.one-time=&quot;300&quot;   
  on-get-more-results.bind=&quot;_onFilterChanged&quot;
  &gt;&lt;/du-compact-people-picker&gt;
  &lt;du-label&gt;Below list is bound to aurelia property on view model&lt;/du-label&gt;
  &lt;ul&gt;
    &lt;li style=&quot;list-style-type: none;&quot; repeat.for=&quot;item of selectedItemsLimited&quot;&gt;${item.text}&lt;/li&gt;
  &lt;/ul&gt;
    </hljs>
  </div>
  <div slot="example">
    <du-compact-people-picker
    on-change.bind="onChangeLimited"
    items.bind="selectedItemsLimited"
    on-item-selected.bind="onItemSelected"
    on-resolve-suggestions.bind="_onFilterChangedWithLimit"
    get-text-from-item.bind="_getTextFromItem"
    input-props.bind="inputProps" 
    on-empty-input-focus.bind="_returnMostRecentlyUsedWithLimit"
    class-name="ms-PeoplePicker"
    picker-suggestions-props.bind="limitedSearchSuggestionProps"
    key="compact"
    on-remove-suggestion.bind="_onRemoveSuggestion"
    on-validate-input.bind="_validateInput"
    resolve-delay.one-time="300"   
    on-get-more-results.bind="_onFilterChanged"
    ></du-compact-people-picker>
    <du-label>Below list is bound to aurelia property on view model</du-label>
    <ul>
      <li style="list-style-type: none;" repeat.for="item of selectedItemsLimited">${item.text}</li>
    </ul>
  </div>  
</examplecard>

  </div>
</template>
